# Настройки Qwen Code для проекта CarMatch

## Оглавление
- [Описание проекта](#описание-проекта)
- [Структура проекта](#структура-проекта)
- [Бизнес-цели](#бизнес-цели)
- [Уникальное ценностное предложение](#уникальное-ценностное-предложение)
- [Ключевые метрики успеха](#ключевые-метрики-успеха)
- [Пользовательские роли](#пользовательские-роли)
- [Основные пользовательские сценарии](#основные-пользовательские-сценарии)
- [Функциональные модули](#функциональные-модули)
- [Технологии](#технологии)
- [Структура БД](#структура-бд)
- [API спецификация](#api-спецификация)
- [Безопасность](#безопасность)
- [Контекст для Qwen Code](#контекст-для-qwen-code)
- [Часто используемые команды](#часто-используемые-команды)
- [Локальный запуск приложения](#локальный-запуск-приложения)
- [Насколько важна ошибка при установке зависимостей](#насколько-важна-ошибка-при-установке-зависимостей)
- [Установка Python и добавление в PATH](#установка-python-и-добавление-в-path-если-необходимо)
- [Особые инструкции](#особые-инструкции)
- [Глобальные настройки](#глобальные-настройки)

## Описание проекта
CarMatch — это интерактивный AI-консультант по подбору автомобилей, который заменяет сложные формы фильтров естественным диалогом на русском языке.

**Миссия:** Сделать процесс выбора автомобиля таким же простым, как разговор с опытным другом-автолюбителем.

**Решаемая проблема:**
- Для пользователей: Сложность формулирования точных требований к автомобилю через стандартные фильтры
- Для бизнеса: Высокий процент оттока пользователей на этапе сложных форм ввода
- Рыночный разрыв: Отсутствие русскоязычных AI-решений для подбора авто с контекстным диалогом

## Структура проекта
- `backend/` - серверная часть приложения (FastAPI)
- `frontend/` - клиентская часть приложения (React 18+)
- `cars.xml` - файл с данными о машинах (Yandex Auto Export)
- `CarMatch_doc.md` - техническое задание проекта
- `Проект CarMatch.docx` - документация в формате Word

## Бизнес-цели (на 6 месяцев после запуска)
**Количественные:**
1. Привлечь 5,000 зарегистрированных пользователей
2. Достичь конверсии в завершенный подбор 40%
3. Получить 2,000 подписок на email-рассылку
4. Сократить время подбора авто с 15 до 5 минут

**Качественные:**
1. Создать "wow-эффект" через естественный диалог
2. Сформировать базу предпочтений российских автопокупателей
3. Стать референсом в сегменте AI-консультантов

## Уникальное ценностное предложение
1. **Контекстный диалог** — ИИ задает умные уточняющие вопросы
2. **Русский автоподбор** — Специфичная для РФ логика (пробег, ТО, нюансы рынка)
3. **Полный цикл** — От пожеланий до конкретных предложений с ценами
4. **Простота** — Никаких сложных форм и сотен фильтров

## Ключевые метрики успеха (KPI)
| Метрика | Цель MVP | Цель Год |
|---------|----------|----------|
| Daily Active Users (DAU) | 100 | 500 |
| Конверсия в подбор | 30% | 45% |
| Средняя оценка (1-5) | 4.0 | 4.5 |
| Время до первого результата | < 3 мин | < 2 мин |
| Retention Rate (7 дней) | 25% | 40% |

## Пользовательские роли
| Роль | Доступ | Описание |
|------|--------|----------|
| **Пользователь** | Полный доступ к чату, история диалогов | Зарегистрированный клиент (обязательная регистрация) |
| **Администратор** | Управление контентом, просмотр статистики | Сотрудник компании |
| **Супер-админ** | Управление LLM-параметрами, доступ к логам | Технический специалист |

## Основные пользовательские сценарии
1. **Регистрация и первичный подбор** - пользователь регистрируется и получает рекомендацию автомобиля, описывая свои потребности в чате
2. **Сравнение вариантов** - пользователь сравнивает несколько понравившихся автомобилей
3. **Уточнение по обслуживанию** - пользователь узнает реальную стоимость владения

## Функциональные модули (MVP Must Have)
1. **Обязательная регистрация/авторизация**
2. **Чат-интерфейс** с историей сообщений
3. **AI-диалог** с извлечением параметров
4. **Подбор автомобилей** (базовая логика)
5. **Отображение результатов** (список + детали)
6. **Сохранение истории** диалогов

## Технологии
### Frontend
- **Фреймворк**: React 18+
- **Стилизация**: CSS Modules
- **Состояние**: Redux Toolkit
- **Роутинг**: React Router v6
- **Запросы**: Axios + React Query
- **Чат-компоненты**: Custom WebSocket
- **Сборка**: Vite
- **Язык**: TypeScript

### Backend
- **Фреймворк**: FastAPI (Python)
- **БД**: PostgreSQL (бесплатные облачные варианты)
- **ORM**: SQLAlchemy 2.0 + Alembic
- **Кэш**: Redis (если потребуется)
- **Очереди**: Celery (для фоновых задач)
- **AI инференс**: Ollama + Qwen2.5
- **Аутентификация**: JWT tokens

### Бесплатный хостинг
- **Frontend**: Vercel (бесплатно)
- **Backend**: Render (бесплатный tier)
- **Database**: Supabase PostgreSQL (бесплатно)

## Структура БД
### Таблица `users`
- id, email, password_hash, is_active, is_admin, created_at, last_login, login_count

### Таблица `sessions`
- id, user_id, status, extracted_params, search_criteria, search_results, created_at, updated_at, completed_at

### Таблица `chat_messages`
- id, session_id, role, content, metadata, sequence_order, created_at

### Таблица `cars`
- id, source, source_id, mark_name, model_name, body_type, year, price_rub, fuel_type, engine_volume, horsepower, transmission, specs, images, description, is_active, imported_at, updated_at

### Таблица `search_parameters`
- id, session_id, param_type, param_value, confidence, message_id, created_at

## API спецификация
### Базовый URL: `https://api.carmatch.app/v1`

### Основные эндпоинты:
- `POST /auth/register` - регистрация пользователя
- `POST /chat/sessions` - создание новой сессии
- `GET /cars/search` - поиск автомобилей по параметрам
- WebSocket: `wss://api.carmatch.app/ws/chat/{session_id}` - чат-соединение

## Безопасность
- HTTPS везде
- JWT аутентификация
- Хеширование паролей bcrypt
- CORS политика
- Rate limiting
- Защита от SQL injection

## Контекст для Qwen Code
При выполнении задач учитывай, что это веб-приложение для подбора автомобилей с использованием ИИ. Фокусируйся на создании удобного чат-интерфейса для пользователей, эффективной логики извлечения параметров из диалога, а также на качественной интеграции между бэкендом и фронтендом. Обязательна регистрация пользователей, используется русскоязычный ИИ-ассистент для подбора автомобилей.

## Часто используемые команды
- Запуск бэкенда: `docker-compose -f docker-compose.dev.yml up`
- Миграции БД: `docker-compose exec backend alembic upgrade head`
- Запуск фронта: `npm run dev` (в директории frontend)
- Тестирование: `pytest` (для бэкенда), `npm test` (для фронта)

## Локальный запуск приложения
Для запуска приложения локально выполните следующие шаги:

### 1. Установка зависимостей для бэкенда:
Если возникает ошибка "pip is not recognized", убедитесь, что Python установлен и добавлен в PATH, или используйте:
```bash
cd backend
python -m pip install --upgrade pip
python -m pip install -r requirements.txt
```

### 2. Настройка базы данных:
- Установите PostgreSQL локально или используйте Docker
- Обновите .env файл с правильными параметрами подключения
- Выполните миграции базы данных:
```bash
cd backend
python -m alembic upgrade head
```

### 3. Запуск бэкенда:
```bash
cd backend
python -m uvicorn main:app --reload
```

### 4. Установка зависимостей для фронтенда:
```bash
cd frontend
npm install
```

### 5. Запуск фронтенда:
```bash
cd frontend
npm start
```

### 6. Альтернативный способ через Docker Compose:
```bash
docker-compose up --build
```

После запуска приложение будет доступно по адресу http://localhost:3000, а API бэкенда - по адресу http://localhost:8000.

## Установка Python и добавление в PATH (если необходимо):
1. Скачайте Python с официального сайта python.org
2. При установке обязательно отметьте "Add Python to PATH"
3. Перезапустите командную строку после установки
4. Проверьте установку командами:
```bash
python --version
pip --version
```

## Насколько важна ошибка при установке зависимостей:
Ошибка при установке зависимостей является **важной**, но не критичной для понимания архитектуры приложения. Она препятствует локальному запуску приложения, но не влияет на структуру кода.

**Уровень важности**: Высокий - без установленных зависимостей приложение не будет работать локально.

**Возможные решения**:
- Использовать Docker для запуска приложения (это самый надежный способ избежать проблем с зависимостями)
- Решать ошибки установки зависимостей по мере поступления (см. ниже)

1. **Ошибка "Microsoft Visual C++ 14.0 is required"**:
   - Установите Microsoft C++ Build Tools или Visual Studio Community
   - Или используйте предкомпилированные версии пакетов из whl файлов

2. **Ошибка "failed building wheel for [package-name]"**:
   - Обновите pip: `python -m pip install --upgrade pip`
   - Установите зависимости по отдельности
   - Используйте альтернативный источник пакетов

3. **Проблемы с совместимостью версий**:
   - Используйте виртуальное окружение: `python -m venv venv` и `venv\Scripts\activate`
   - Установите конкретные версии пакетов из requirements.txt вручную

4. **Проблемы с сетью/прокси**:
   - Используйте зеркала PyPI: `pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/`
   - Проверьте настройки прокси в вашей сети

5. **Ошибка "metadata-generation-failed" для pydantic-core или других пакетов**:
   - Обновите pip, setuptools и wheel: `python -m pip install --upgrade pip setuptools wheel`
   - Установите pydantic-core отдельно: `python -m pip install pydantic-core`
   - Используйте предварительно скомпилированные пакеты: `pip install --only-binary=all -r requirements.txt`
   - Попробуйте использовать Conda вместо pip для установки проблемных пакетов

## Особые инструкции
- Придерживайся современных практик разработки
- Обеспечь адаптивный дизайн для мобильных устройств
- Реализуй эффективную систему контекстного диалога с ИИ
- Обеспечь безопасность пользовательских данных
- Используй TypeScript для фронтенда и Python с аннотациями типов для бэкенда
- Следи за тем, чтобы ИИ задавал уточняющие вопросы для сбора параметров (бюджет, тип кузова, год выпуска, тип топлива, коробка передач)
- После сбора 3+ параметров предлагай поиск автомобилей
- Используй Yandex Auto Export для каталога автомобилей

## Глобальные настройки
### Языковые предпочтения
- Основной язык общения: русский
- Техническая терминология: английская (где необходимо)
- Комментарии в коде: как указано в настройках конкретного проекта

### Общие предпочтения
- Стиль программирования: чистый и понятный код
- Именование переменных: говорящие имена (descriptive names)
- Документирование: краткие, но информативные комментарии
- Тестирование: покрывать основной функционал модульными тестами

### Рабочие привычки
- Предпочитаю итеративную разработку
- Проверять код на ошибки и уязвимости перед завершением задачи
- Следить за последними тенденциями веб-разработки
- Использовать лучшие практики безопасности

### Стиль взаимодействия
- Предоставлять четкие объяснения
- Предлагать несколько вариантов решения, если применимо
- Уточнять требования, если они неясны
- Делать акцент на практичности и реализуемости решений